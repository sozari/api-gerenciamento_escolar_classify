<script>
    async function carregarAlunos(idTurma) {
        try {
            const resposta = await fetch(`/turmas/${idTurma}`);
            if (!resposta.ok) throw new Error('Erro ao carregar os alunos');
            const alunos = await resposta.json();

            const tabela = document.querySelector('tbody');
            tabela.innerHTML = '';

            alunos.forEach(aluno => {
                const linha = document.createElement('tr');
                linha.innerHTML = `
                    <td>${aluno.idaluno}</td>
                    <td>${aluno.nome_aluno}</td>
                    <td><input type="number" value="${aluno.nota1 || ''}" data-aluno="${aluno.idaluno}" data-nota="nota1"></td>
                    <td><input type="number" value="${aluno.nota2 || ''}" data-aluno="${aluno.idaluno}" data-nota="nota2"></td>
                    <td><input type="number" value="${aluno.nota3 || ''}" data-aluno="${aluno.idaluno}" data-nota="nota3"></td>
                    <td>${aluno.media || ''}</td>
                    <td>
                        <button class="btn" onclick="salvarNotas(${aluno.idaluno}, ${idTurma})">Salvar Notas</button>
                    </td>
                `;
                tabela.appendChild(linha);
            });
        } catch (erro) {
            console.error('Erro ao carregar os alunos:', erro);
        }
    }

    async function salvarNotas(idAluno, idTurma) {
        const inputs = document.querySelectorAll(`[data-aluno="${idAluno}"]`);
        const notas = {
            idAluno: idAluno,
            idTurma: idTurma,
            nota1: inputs[0].value,
            nota2: inputs[1].value,
            nota3: inputs[2].value
        };

        // Enviar as notas para o backend
        try {
            const resposta = await fetch(`/salvar_notas`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(notas)
            });
            const dados = await resposta.json();
            alert(dados.message);
            carregarAlunos(idTurma); // Atualiza a tabela apÃ³s salvar
        } catch (erro) {
            console.error('Erro ao salvar as notas:', erro);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const idTurma = new URLSearchParams(window.location.search).get('idTurma');
        if (idTurma) carregarAlunos(idTurma);
    });
</script>
